'use strict';window.tsfPTGB=function(a){const b="undefined"!=typeof tsfPTL10n&&tsfPTL10n,{addFilter:c}=wp.hooks,{createElement:d,Fragment:e}=wp.element,{SelectControl:f}=wp.components,{addQueryArgs:g}=wp.url,h=wp.apiFetch,{invoke:i}=lodash,j={per_page:-1,orderby:"id",order:"asc",_fields:"id,name"},k=()=>{if(!Object.keys(b.taxonomies).length)return;let k=b.taxonomies,l=wp.template("tsf-primary-term-selector"),m={};const n=(a,b)=>b in k[a].i18n&&k[a].i18n[b]||"",o=a=>document.getElementById(`autodescription[_primary_term_${a}]`),p=a=>+o(a).value,q=(a,b)=>+(o(a).value=+b),r=b=>{let c=document.getElementById("tsf-gutenberg-data-holder");if(!c)return m[b]=!1;let d=l({taxonomy:k[b]});return m[b]=!!a(d).appendTo(c)},s=a=>m[a],t=(a,b)=>{0>b.indexOf(p(a))&&(0 in b?q(a,b[0]):q(a,0))};var u={};class v{constructor(a){this.slug=a,this.reset()}registeredData(){return!!Object.keys(this.data).length}reset(){this.data={}}read(){return this.data}get(a){return a in this.data&&this.data[a]||null}set(a,b){return this.data[a]=b}}const w=a=>u[a]=new v(a),x=a=>u[a]||w(a);class y extends React.Component{constructor(a){super(a),this.state={loading:!0}}componentDidMount(){this.updateData(),this.dsAccess().registeredData()&&this.setState({loading:!1})}componentWillUnmount(){i(this.fetchRequest,["abort"]),i(this.addRequest,["abort"])}componentDidUpdate(a){if(this.updateData(),2<this.props.terms.length&&!this.dsAccess().get("availableTerms"))this.fetchTerms();else if(this.props.terms!==a.terms){let b=this.props.terms.filter(b=>-1===a.terms.indexOf(b));b.length&&!this.isTermAvailable(b[0])&&this.fetchTerms()}}updateData(){this.dsAccess().registeredData()||(this.dsAccess().set("availableTerms",[]),this.fetchTerms()),this.dsAccess().set("selectedTerms",this.props.terms)}updateTerms(){this.updateData()}dsAccess(){return x(this.props.slug)}isTermAvailable(a){let b=this.dsAccess().get("availableTerms");return b.some(b=>b.id===a)}fetchTerms(){const{taxonomy:a}=this.props;a&&(this.setState({selectedTerms:this.props.terms,loading:!0}),this.fetchRequest=h({path:g(`/wp/v2/${a.rest_base}`,j)}),this.fetchRequest.then(a=>{this.fetchRequest=null,this.setState({loading:!1}),this.dsAccess().set("availableTerms",a),this.forceUpdate()},a=>{"abort"===a.statusText||(this.fetchRequest=null,this.setState({loading:!1}),this.forceUpdate())}))}}class z extends y{constructor(a){super(a),this.onChange=this.onChange.bind(this)}getTermName(a){let b=this.dsAccess().get("availableTerms"),c=b.find(b=>b.id===a);return c&&c.name||""}getSelectOptions(){return this.dsAccess().get("selectedTerms").sort().map(a=>({value:a,label:this.getTermName(a)}))}onChange(a){this.setState({options:this.getSelectOptions(),value:q(this.props.slug,a)}),tsfAys&&tsfAys.registerChange()}isDisabled(){return!!this.state.loading}render(){return this.updateData(),d(f,{label:n(this.props.slug,"selectPrimary"),value:p(this.props.slug),className:"tsf-pt-gb-selector",onChange:this.onChange,options:this.state.loading?"":this.getSelectOptions(),disabled:this.isDisabled()})}}const A=a=>class extends y{initSelectors(){const{slug:a,terms:b}=this.props;return s(a)&&(t(a,b),1<b.length)?d(e,{},d(z,this.props)):null}render(){return!this.props.slug in k?void 0:d(e,{},d(a,this.props),this.initSelectors())}};(()=>{for(let a in k)r(a);c("editor.PostTaxonomyType","tsf/pt",A,20)})()};return Object.assign({load:()=>{a(document.body).on("tsf-onload",k)}},{},{l10n:b})}(jQuery),jQuery(window.tsfPTGB.load);
